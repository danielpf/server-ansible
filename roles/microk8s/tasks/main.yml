- name: add to group
  user:
    name: "{{ item }}"
    groups: microk8s
    append: yes
  become: true
  with_items: [danielf, ansible]

- name: install helm
  become: true
  snap:
    name: [kubectl, helm]  # do we actually need kubectl?
    classic: true

- name: create kube cfg dir
  become: true
  file:
    path: /home/danielf/.kube
    state: directory

- name: create kube cfg file
  become: true
  shell: |
    microk8s kubectl config view --raw > /home/danielf/.kube/config
  args:
    creates: /home/danielf/.kube/config

- name: kube cfg files permissions
  become: true
  file:
    path: /home/danielf/.kube
    owner: danielf
    group: danielf
    recurse: yes

- name: kube cfg file permissions
  become: true
  file:
    path: /home/danielf/.kube/config
    mode: 0550

- name: enable some services
  command: microk8s.enable dashboard dns ingress registry

