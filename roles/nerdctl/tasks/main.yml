- name: check latest release
  uri:
    url: https://api.github.com/repos/containerd/nerdctl/releases/latest
    return_content: true
  no_log: true
  register: json_response

- name: get download url
  ansible.builtin.debug:
    var: item
  loop: "{{ json_response.json | community.general.json_query(release_query) }}"
  vars:
    release_query: "assets[?contains(name,'linux-amd64')&&contains(name,'full')].browser_download_url"
  register: nerdctl_release_url

- name: testing
  ansible.builtin.debug:
    msg: "{{ nerdctl_release_url.results[0].item }}"

- get_url:
    url: "{{ url }}"
    dest: "{{ ansible_env.HOME }}/{{ url | urlsplit('path') | regex_search('[^/]+$') }}"
  vars:
    url: "{{ nerdctl_release_url.results[0].item }}"

# - extract:
